"use strict";var cov_2am20tn6sh=function(){var path="/Users/psantos/Desktop/IWA/CA/src/backend/middleware/auth_middleware.ts",hash="25d56344f522b8d5b1721c85d72405c87062f67f",Function=function(){}.constructor,global=new Function('return this')(),gcv="__coverage__",coverageData={path:"/Users/psantos/Desktop/IWA/CA/src/backend/middleware/auth_middleware.ts",statementMap:{"0":{start:{line:2,column:19},end:{line:8,column:1}},"1":{start:{line:3,column:4},end:{line:3,column:42}},"2":{start:{line:3,column:31},end:{line:3,column:42}},"3":{start:{line:4,column:17},end:{line:4,column:19}},"4":{start:{line:5,column:4},end:{line:5,column:99}},"5":{start:{line:5,column:21},end:{line:5,column:99}},"6":{start:{line:5,column:40},end:{line:5,column:99}},"7":{start:{line:5,column:80},end:{line:5,column:99}},"8":{start:{line:6,column:4},end:{line:6,column:28}},"9":{start:{line:7,column:4},end:{line:7,column:18}},"10":{start:{line:9,column:0},end:{line:9,column:62}},"11":{start:{line:10,column:10},end:{line:10,column:47}},"12":{start:{line:12,column:4},end:{line:46,column:5}},"13":{start:{line:14,column:20},end:{line:14,column:48}},"14":{start:{line:16,column:8},end:{line:42,column:9}},"15":{start:{line:17,column:12},end:{line:17,column:35}},"16":{start:{line:21,column:25},end:{line:21,column:48}},"17":{start:{line:23,column:12},end:{line:41,column:13}},"18":{start:{line:24,column:16},end:{line:24,column:39}},"19":{start:{line:27,column:30},end:{line:27,column:36}},"20":{start:{line:28,column:16},end:{line:35,column:17}},"21":{start:{line:30,column:20},end:{line:30,column:56}},"22":{start:{line:34,column:20},end:{line:34,column:43}},"23":{start:{line:38,column:16},end:{line:38,column:40}},"24":{start:{line:40,column:16},end:{line:40,column:23}},"25":{start:{line:45,column:8},end:{line:45,column:31}},"26":{start:{line:48,column:0},end:{line:48,column:40}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:2,column:50},end:{line:2,column:51}},loc:{start:{line:2,column:65},end:{line:8,column:1}},line:2},"1":{name:"authMiddleware",decl:{start:{line:11,column:9},end:{line:11,column:23}},loc:{start:{line:11,column:40},end:{line:47,column:1}},line:11}},branchMap:{"0":{loc:{start:{line:2,column:19},end:{line:8,column:1}},type:"binary-expr",locations:[{start:{line:2,column:20},end:{line:2,column:24}},{start:{line:2,column:28},end:{line:2,column:45}},{start:{line:2,column:50},end:{line:8,column:1}}],line:2},"1":{loc:{start:{line:3,column:4},end:{line:3,column:42}},type:"if",locations:[{start:{line:3,column:4},end:{line:3,column:42}},{start:{line:3,column:4},end:{line:3,column:42}}],line:3},"2":{loc:{start:{line:3,column:8},end:{line:3,column:29}},type:"binary-expr",locations:[{start:{line:3,column:8},end:{line:3,column:11}},{start:{line:3,column:15},end:{line:3,column:29}}],line:3},"3":{loc:{start:{line:5,column:4},end:{line:5,column:99}},type:"if",locations:[{start:{line:5,column:4},end:{line:5,column:99}},{start:{line:5,column:4},end:{line:5,column:99}}],line:5},"4":{loc:{start:{line:5,column:40},end:{line:5,column:99}},type:"if",locations:[{start:{line:5,column:40},end:{line:5,column:99}},{start:{line:5,column:40},end:{line:5,column:99}}],line:5},"5":{loc:{start:{line:16,column:8},end:{line:42,column:9}},type:"if",locations:[{start:{line:16,column:8},end:{line:42,column:9}},{start:{line:16,column:8},end:{line:42,column:9}}],line:16},"6":{loc:{start:{line:16,column:12},end:{line:16,column:55}},type:"binary-expr",locations:[{start:{line:16,column:12},end:{line:16,column:31}},{start:{line:16,column:35},end:{line:16,column:55}}],line:16},"7":{loc:{start:{line:23,column:12},end:{line:41,column:13}},type:"if",locations:[{start:{line:23,column:12},end:{line:41,column:13}},{start:{line:23,column:12},end:{line:41,column:13}}],line:23}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0},f:{"0":0,"1":0},b:{"0":[0,0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();var __importStar=(cov_2am20tn6sh.s[0]++,(cov_2am20tn6sh.b[0][0]++,this)&&(cov_2am20tn6sh.b[0][1]++,this.__importStar)||(cov_2am20tn6sh.b[0][2]++,function(mod){cov_2am20tn6sh.f[0]++;cov_2am20tn6sh.s[1]++;if((cov_2am20tn6sh.b[2][0]++,mod)&&(cov_2am20tn6sh.b[2][1]++,mod.__esModule)){cov_2am20tn6sh.b[1][0]++;cov_2am20tn6sh.s[2]++;return mod;}else{cov_2am20tn6sh.b[1][1]++;}var result=(cov_2am20tn6sh.s[3]++,{});cov_2am20tn6sh.s[4]++;if(mod!=null){cov_2am20tn6sh.b[3][0]++;cov_2am20tn6sh.s[5]++;for(var k in mod){cov_2am20tn6sh.s[6]++;if(Object.hasOwnProperty.call(mod,k)){cov_2am20tn6sh.b[4][0]++;cov_2am20tn6sh.s[7]++;result[k]=mod[k];}else{cov_2am20tn6sh.b[4][1]++;}}}else{cov_2am20tn6sh.b[3][1]++;}cov_2am20tn6sh.s[8]++;result["default"]=mod;cov_2am20tn6sh.s[9]++;return result;}));cov_2am20tn6sh.s[10]++;Object.defineProperty(exports,"__esModule",{value:true});var jwt=(cov_2am20tn6sh.s[11]++,__importStar(require("jsonwebtoken")));function authMiddleware(req,res,next){cov_2am20tn6sh.f[1]++;cov_2am20tn6sh.s[12]++;try{// Read token from request headers
var token=(cov_2am20tn6sh.s[13]++,req.headers["authorization"]);// If no token not a string, it is an invalid request
cov_2am20tn6sh.s[14]++;if((cov_2am20tn6sh.b[6][0]++,token===undefined)||(cov_2am20tn6sh.b[6][1]++,Array.isArray(token))){cov_2am20tn6sh.b[5][0]++;cov_2am20tn6sh.s[15]++;res.status(400).send();}else{cov_2am20tn6sh.b[5][1]++;// Read secret from environment variables
var secret=(cov_2am20tn6sh.s[16]++,process.env.AUTH_SECRET);// If secret is undefined, there is an internal server error
cov_2am20tn6sh.s[17]++;if(!secret){cov_2am20tn6sh.b[7][0]++;cov_2am20tn6sh.s[18]++;res.status(500).send();}else{cov_2am20tn6sh.b[7][1]++;var decoded=(cov_2am20tn6sh.s[19]++,void 0);cov_2am20tn6sh.s[20]++;try{cov_2am20tn6sh.s[21]++;// Decode token and get user id
decoded=jwt.verify(token,secret);}catch(e){cov_2am20tn6sh.s[22]++;// If cannot decode token, the user is unauthorized
res.status(401).send();}// Attach current user to request objs
// Note that we don't need to do additional db queries
cov_2am20tn6sh.s[23]++;req.userId=decoded.id;// Invoke next handler
cov_2am20tn6sh.s[24]++;next();}}}catch(e){cov_2am20tn6sh.s[25]++;res.status(500).send();}}cov_2am20tn6sh.s[26]++;exports.authMiddleware=authMiddleware;// docker run --name POSTGRES_USER -p "$DATABASE_PORT":5432 \ -e POSTGRES_PASSWORD=secret \
// -e POSTGRES_USER=postgres \
// -e POSTGRES_DB=demo \
// -d postgres
// export DATABASE_USER=postgres \
// export DATABASE_PASSWORD=secret \ export DATABASE_HOST=localhost \ export DATABASE_PORT=5432 \ export DATABASE_DB=demo
// docker run --name POSTGRES_USER -p DATABASE_PORT:$DATABASE_PORT \ -e POSTGRES_PASSWORD=$DATABASE_PASSWORD \ -e POSTGRES_USER=$DATABASE_USER \ -e POSTGRES_DB=$DATABASE_DB \ -d postgres
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL3BzYW50b3MvRGVza3RvcC9JV0EvQ0Evc3JjL2JhY2tlbmQvbWlkZGxld2FyZS9hdXRoX21pZGRsZXdhcmUudHMiLCJzb3VyY2VzIjpbIi9Vc2Vycy9wc2FudG9zL0Rlc2t0b3AvSVdBL0NBL3NyYy9iYWNrZW5kL21pZGRsZXdhcmUvYXV0aF9taWRkbGV3YXJlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUNBLGdEQUFvQztBQUlwQyx3QkFDSSxHQUFvQixFQUNwQixHQUFxQixFQUNyQixJQUEwQjtJQUUxQixJQUFJO1FBQ0Esa0NBQWtDO1FBQ2xDLElBQU0sS0FBSyxHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUM7UUFDM0MscURBQXFEO1FBQ3JELElBQUksS0FBSyxLQUFLLFNBQVMsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQzdDLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7U0FDMUI7YUFBTTtZQUNILHlDQUF5QztZQUN6QyxJQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQztZQUN2Qyw0REFBNEQ7WUFDNUQsSUFBSSxDQUFDLE1BQU0sRUFBRTtnQkFDVCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO2FBQzFCO2lCQUFNO2dCQUNILElBQUksT0FBTyxTQUFLLENBQUM7Z0JBQ2pCLElBQUk7b0JBQ0EsK0JBQStCO29CQUMvQixPQUFPLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFRLENBQUM7aUJBQzlDO2dCQUFDLE9BQU0sQ0FBQyxFQUFFO29CQUNQLG1EQUFtRDtvQkFDbkQsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztpQkFDMUI7Z0JBQ0Qsc0NBQXNDO2dCQUN0QyxzREFBc0Q7Z0JBQ3JELEdBQVcsQ0FBQyxNQUFNLEdBQUcsT0FBTyxDQUFDLEVBQUUsQ0FBQztnQkFDakMsc0JBQXNCO2dCQUN0QixJQUFJLEVBQUUsQ0FBQzthQUNWO1NBQ0o7S0FDSjtJQUFDLE9BQU8sQ0FBQyxFQUFFO1FBQ1IsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztLQUMxQjtBQUNMLENBQUM7QUFwQ0Qsd0NBb0NDO0FBRUQsMkZBQTJGO0FBQzNGLDhCQUE4QjtBQUM5Qix3QkFBd0I7QUFDeEIsY0FBYztBQUVkLGtDQUFrQztBQUNsQyx5SEFBeUg7QUFFekgsMExBQTBMIiwic291cmNlc0NvbnRlbnQiOlsiXG5pbXBvcnQgKiBhcyBqd3QgZnJvbSBcImpzb253ZWJ0b2tlblwiO1xuaW1wb3J0IHsgZ2V0UmVwb3NpdG9yeSB9IGZyb20gJy4uL3JlcG9zaXRvcmllcy91c2VyX3JlcG9zaXRvcnknO1xuaW1wb3J0IGV4cHJlc3MgZnJvbSBcImV4cHJlc3NcIjtcblxuZXhwb3J0IGZ1bmN0aW9uIGF1dGhNaWRkbGV3YXJlKFxuICAgIHJlcTogZXhwcmVzcy5SZXF1ZXN0LFxuICAgIHJlczogZXhwcmVzcy5SZXNwb25zZSxcbiAgICBuZXh0OiBleHByZXNzLk5leHRGdW5jdGlvblxuKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgLy8gUmVhZCB0b2tlbiBmcm9tIHJlcXVlc3QgaGVhZGVyc1xuICAgICAgICBjb25zdCB0b2tlbiA9IHJlcS5oZWFkZXJzW1wiYXV0aG9yaXphdGlvblwiXTtcbiAgICAgICAgLy8gSWYgbm8gdG9rZW4gbm90IGEgc3RyaW5nLCBpdCBpcyBhbiBpbnZhbGlkIHJlcXVlc3RcbiAgICAgICAgaWYgKHRva2VuID09PSB1bmRlZmluZWQgfHwgQXJyYXkuaXNBcnJheSh0b2tlbikpIHtcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoNDAwKS5zZW5kKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBSZWFkIHNlY3JldCBmcm9tIGVudmlyb25tZW50IHZhcmlhYmxlc1xuICAgICAgICAgICAgY29uc3Qgc2VjcmV0ID0gcHJvY2Vzcy5lbnYuQVVUSF9TRUNSRVQ7XG4gICAgICAgICAgICAvLyBJZiBzZWNyZXQgaXMgdW5kZWZpbmVkLCB0aGVyZSBpcyBhbiBpbnRlcm5hbCBzZXJ2ZXIgZXJyb3JcbiAgICAgICAgICAgIGlmICghc2VjcmV0KSB7XG4gICAgICAgICAgICAgICAgcmVzLnN0YXR1cyg1MDApLnNlbmQoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbGV0IGRlY29kZWQ6IGFueTtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAvLyBEZWNvZGUgdG9rZW4gYW5kIGdldCB1c2VyIGlkXG4gICAgICAgICAgICAgICAgICAgIGRlY29kZWQgPSBqd3QudmVyaWZ5KHRva2VuLCBzZWNyZXQpIGFzIGFueTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gSWYgY2Fubm90IGRlY29kZSB0b2tlbiwgdGhlIHVzZXIgaXMgdW5hdXRob3JpemVkXG4gICAgICAgICAgICAgICAgICAgIHJlcy5zdGF0dXMoNDAxKS5zZW5kKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIEF0dGFjaCBjdXJyZW50IHVzZXIgdG8gcmVxdWVzdCBvYmpzXG4gICAgICAgICAgICAgICAgLy8gTm90ZSB0aGF0IHdlIGRvbid0IG5lZWQgdG8gZG8gYWRkaXRpb25hbCBkYiBxdWVyaWVzXG4gICAgICAgICAgICAgICAgKHJlcSBhcyBhbnkpLnVzZXJJZCA9IGRlY29kZWQuaWQ7XG4gICAgICAgICAgICAgICAgLy8gSW52b2tlIG5leHQgaGFuZGxlclxuICAgICAgICAgICAgICAgIG5leHQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLnNlbmQoKTtcbiAgICB9XG59XG5cbi8vIGRvY2tlciBydW4gLS1uYW1lIFBPU1RHUkVTX1VTRVIgLXAgXCIkREFUQUJBU0VfUE9SVFwiOjU0MzIgXFwgLWUgUE9TVEdSRVNfUEFTU1dPUkQ9c2VjcmV0IFxcXG4vLyAtZSBQT1NUR1JFU19VU0VSPXBvc3RncmVzIFxcXG4vLyAtZSBQT1NUR1JFU19EQj1kZW1vIFxcXG4vLyAtZCBwb3N0Z3Jlc1xuXG4vLyBleHBvcnQgREFUQUJBU0VfVVNFUj1wb3N0Z3JlcyBcXFxuLy8gZXhwb3J0IERBVEFCQVNFX1BBU1NXT1JEPXNlY3JldCBcXCBleHBvcnQgREFUQUJBU0VfSE9TVD1sb2NhbGhvc3QgXFwgZXhwb3J0IERBVEFCQVNFX1BPUlQ9NTQzMiBcXCBleHBvcnQgREFUQUJBU0VfREI9ZGVtb1xuXG4vLyBkb2NrZXIgcnVuIC0tbmFtZSBQT1NUR1JFU19VU0VSIC1wIERBVEFCQVNFX1BPUlQ6JERBVEFCQVNFX1BPUlQgXFwgLWUgUE9TVEdSRVNfUEFTU1dPUkQ9JERBVEFCQVNFX1BBU1NXT1JEIFxcIC1lIFBPU1RHUkVTX1VTRVI9JERBVEFCQVNFX1VTRVIgXFwgLWUgUE9TVEdSRVNfREI9JERBVEFCQVNFX0RCIFxcIC1kIHBvc3RncmVzIl19