"use strict";var cov_in3x8zhwd=function(){var path="/Users/psantos/Desktop/IWA/CA/src/backend/controllers/user_controller.ts",hash="52d28eb271dfa2e72da3f92e3e37fe9b8a0ec5f4",Function=function(){}.constructor,global=new Function('return this')(),gcv="__coverage__",coverageData={path:"/Users/psantos/Desktop/IWA/CA/src/backend/controllers/user_controller.ts",statementMap:{"0":{start:{line:2,column:0},end:{line:2,column:62}},"1":{start:{line:3,column:16},end:{line:3,column:34}},"2":{start:{line:4,column:24},end:{line:4,column:66}},"3":{start:{line:5,column:17},end:{line:5,column:35}},"4":{start:{line:6,column:0},end:{line:6,column:32}},"5":{start:{line:8,column:0},end:{line:16,column:3}},"6":{start:{line:9,column:25},end:{line:9,column:58}},"7":{start:{line:10,column:4},end:{line:15,column:7}},"8":{start:{line:11,column:8},end:{line:11,column:23}},"9":{start:{line:13,column:8},end:{line:13,column:24}},"10":{start:{line:14,column:8},end:{line:14,column:28}},"11":{start:{line:18,column:0},end:{line:44,column:3}},"12":{start:{line:19,column:25},end:{line:19,column:58}},"13":{start:{line:20,column:18},end:{line:20,column:26}},"14":{start:{line:21,column:4},end:{line:24,column:5}},"15":{start:{line:22,column:8},end:{line:22,column:24}},"16":{start:{line:23,column:8},end:{line:23,column:50}},"17":{start:{line:26,column:20},end:{line:31,column:6}},"18":{start:{line:33,column:4},end:{line:36,column:5}},"19":{start:{line:34,column:8},end:{line:34,column:24}},"20":{start:{line:35,column:8},end:{line:35,column:65}},"21":{start:{line:38,column:4},end:{line:43,column:7}},"22":{start:{line:39,column:8},end:{line:39,column:23}},"23":{start:{line:41,column:8},end:{line:41,column:24}},"24":{start:{line:42,column:8},end:{line:42,column:28}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:8,column:32},end:{line:8,column:33}},loc:{start:{line:8,column:52},end:{line:16,column:1}},line:8},"1":{name:"(anonymous_1)",decl:{start:{line:10,column:31},end:{line:10,column:32}},loc:{start:{line:10,column:47},end:{line:12,column:5}},line:10},"2":{name:"(anonymous_2)",decl:{start:{line:12,column:13},end:{line:12,column:14}},loc:{start:{line:12,column:26},end:{line:15,column:5}},line:12},"3":{name:"(anonymous_3)",decl:{start:{line:18,column:33},end:{line:18,column:34}},loc:{start:{line:18,column:53},end:{line:44,column:1}},line:18},"4":{name:"(anonymous_4)",decl:{start:{line:38,column:38},end:{line:38,column:39}},loc:{start:{line:38,column:54},end:{line:40,column:5}},line:38},"5":{name:"(anonymous_5)",decl:{start:{line:40,column:13},end:{line:40,column:14}},loc:{start:{line:40,column:26},end:{line:43,column:5}},line:40}},branchMap:{"0":{loc:{start:{line:21,column:4},end:{line:24,column:5}},type:"if",locations:[{start:{line:21,column:4},end:{line:24,column:5}},{start:{line:21,column:4},end:{line:24,column:5}}],line:21},"1":{loc:{start:{line:21,column:10},end:{line:21,column:83}},type:"binary-expr",locations:[{start:{line:21,column:10},end:{line:21,column:43}},{start:{line:21,column:47},end:{line:21,column:83}}],line:21},"2":{loc:{start:{line:33,column:4},end:{line:36,column:5}},type:"if",locations:[{start:{line:33,column:4},end:{line:36,column:5}},{start:{line:33,column:4},end:{line:36,column:5}}],line:33}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0},b:{"0":[0,0],"1":[0,0],"2":[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();cov_in3x8zhwd.s[0]++;Object.defineProperty(exports,"__esModule",{value:true});var express_1=(cov_in3x8zhwd.s[1]++,require("express"));var user_repository_1=(cov_in3x8zhwd.s[2]++,require("../repositories/user_repository"));var userRouter=(cov_in3x8zhwd.s[3]++,express_1.Router());cov_in3x8zhwd.s[4]++;exports.userRouter=userRouter;// Retruns all users
cov_in3x8zhwd.s[5]++;userRouter.get("/api/v1/users",function(req,res){cov_in3x8zhwd.f[0]++;var userRepository=(cov_in3x8zhwd.s[6]++,user_repository_1.getRepository());cov_in3x8zhwd.s[7]++;userRepository.find().then(function(user){cov_in3x8zhwd.f[1]++;cov_in3x8zhwd.s[8]++;res.json(user);}).catch(function(e){cov_in3x8zhwd.f[2]++;cov_in3x8zhwd.s[9]++;res.status(500);cov_in3x8zhwd.s[10]++;res.send(e.message);});});// Creates a new user account
cov_in3x8zhwd.s[11]++;userRouter.post("/api/v1/users",function(req,res){cov_in3x8zhwd.f[3]++;var userRepository=(cov_in3x8zhwd.s[12]++,user_repository_1.getRepository());var newUser=(cov_in3x8zhwd.s[13]++,req.body);cov_in3x8zhwd.s[14]++;if(!((cov_in3x8zhwd.b[1][0]++,typeof newUser.email==="string")||(cov_in3x8zhwd.b[1][1]++,typeof newUser.password==="string"))){cov_in3x8zhwd.b[0][0]++;cov_in3x8zhwd.s[15]++;res.status(400);cov_in3x8zhwd.s[16]++;res.send("Invalid Username or Password!");}else{cov_in3x8zhwd.b[0][1]++;}// Check if the email is already taken
var userCheck=(cov_in3x8zhwd.s[17]++,userRepository.findOne({where:{email:newUser.email,password:newUser.password}}));// Return error 400 in case email has already been taken
cov_in3x8zhwd.s[18]++;if(userCheck){cov_in3x8zhwd.b[2][0]++;cov_in3x8zhwd.s[19]++;res.status(400);cov_in3x8zhwd.s[20]++;res.send("Email already taken, please try another one.");}else{cov_in3x8zhwd.b[2][1]++;}// Return the new user object.
cov_in3x8zhwd.s[21]++;userRepository.find(newUser).then(function(user){cov_in3x8zhwd.f[4]++;cov_in3x8zhwd.s[22]++;res.json(user);}).catch(function(e){cov_in3x8zhwd.f[5]++;cov_in3x8zhwd.s[23]++;res.status(500);cov_in3x8zhwd.s[24]++;res.send(e.message);});});// Handle HTTP requests
// export function getHandlers(_userRepository: Repository<User>) {
//     const getAllUsersHandler = (req: Request, res: Response) => {
//         (async () => {
//             const users = await _userRepository.find();
//             res.json(users).send();
//         })();
//     };
//     const getUserByIdHandler = (req: Request, res: Response) => {
//         const id = parseInt(req.params.id);
//         const user = _userRepository.findOne({
//             where: {
//                 id: id
//             }
//         });
//         if (user === undefined) {
//             res.status(404).send();
//         }
//         res.json(user).send();
//     };
//     const createUser = (req: Request, res: Response) => {
//         (async () => {
//             const email = req.body.email;
//             const password = req.body.password;
//             if (!email || password) {
//                 res.status(400).send();
//             } else {
//                 const newuser = await _userRepository.save({ email: email, password: password});
//                 return res.json(newuser);
//             }            
//         })();
//     };
//     const deleteUser =  (req: Request, res: Response) => {
//         // TODO
//         res.json({});
//     };
//     const getTokenHandler = (req: Request, res: Response) => {
//         (async () => {
//             const body = req.body;
//             const email = body.email;
//             const password = body.password;
//             if (!email || !password) {
//                 res.status(400).send();
//             } else {
//                 const user = await _userRepository.findOne({
//                     where: {
//                         email: email,
//                         password: password
//                     }
//                 });
//                 if (!user) {
//                     res.status(401).send();
//                 } else {
//                     const payload = { id: user.id };
//                     const secret = process.env.AUTH_SECRET;
//                     if (typeof secret === "string") {
//                         const token = jwt.sign(payload, secret);
//                         res.json({ token: token });
//                     } else {
//                         res.status(500).send();
//                     }
//                 }
//             }
//         })();
//     };
//     return {
//         getAllUsersHandler,
//         getUserByIdHandler,
//         createUser,
//         deleteUser,
//         getTokenHandler
//     };
// }
// export function getLinksRouter() {
//     const handlers = getHandlers(getRepository());
//     const userRouter = Router();
//     userRouter.post("/api/v1/users", handlers.getTokenHandler);
//     return userRouter;
// }
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL3BzYW50b3MvRGVza3RvcC9JV0EvQ0Evc3JjL2JhY2tlbmQvY29udHJvbGxlcnMvdXNlcl9jb250cm9sbGVyLnRzIiwic291cmNlcyI6WyIvVXNlcnMvcHNhbnRvcy9EZXNrdG9wL0lXQS9DQS9zcmMvYmFja2VuZC9jb250cm9sbGVycy91c2VyX2NvbnRyb2xsZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxtQ0FBb0Q7QUFDcEQsbUVBQWdFO0FBS2hFLElBQU0sVUFBVSxHQUFHLGdCQUFNLEVBQUUsQ0FBQztBQTBDbkIsZ0NBQVU7QUF6Q25CLG9CQUFvQjtBQUNwQixVQUFVLENBQUMsR0FBRyxDQUFDLGVBQWUsRUFBRSxVQUFVLEdBQUcsRUFBRSxHQUFHO0lBQzlDLElBQU0sY0FBYyxHQUFHLCtCQUFhLEVBQUUsQ0FBQztJQUN2QyxjQUFjLENBQUMsSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDLFVBQUMsSUFBSTtRQUM1QixHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ25CLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxVQUFDLENBQVE7UUFDZCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2hCLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ3hCLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUM7QUFFSCw2QkFBNkI7QUFDN0IsVUFBVSxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUUsVUFBVSxHQUFHLEVBQUUsR0FBRztJQUMvQyxJQUFNLGNBQWMsR0FBRywrQkFBYSxFQUFFLENBQUM7SUFDdkMsSUFBTSxPQUFPLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQztJQUN6QixJQUFHLENBQUMsQ0FBQyxPQUFPLE9BQU8sQ0FBQyxLQUFLLEtBQUssUUFBUSxJQUFJLE9BQU8sT0FBTyxDQUFDLFFBQVEsS0FBSyxRQUFRLENBQUMsRUFBQztRQUM1RSxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2hCLEdBQUcsQ0FBQyxJQUFJLENBQUMsK0JBQStCLENBQUMsQ0FBQztLQUM3QztJQUVELHNDQUFzQztJQUN0QyxJQUFNLFNBQVMsR0FBRyxjQUFjLENBQUMsT0FBTyxDQUFDO1FBQ3JDLEtBQUssRUFBRTtZQUNILEtBQUssRUFBRSxPQUFPLENBQUMsS0FBSztZQUNwQixRQUFRLEVBQUUsT0FBTyxDQUFDLFFBQVE7U0FDN0I7S0FDSixDQUFDLENBQUM7SUFDSCx3REFBd0Q7SUFDeEQsSUFBSSxTQUFTLEVBQUU7UUFDWCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2hCLEdBQUcsQ0FBQyxJQUFJLENBQUMsOENBQThDLENBQUMsQ0FBQztLQUM1RDtJQUNELDhCQUE4QjtJQUM5QixjQUFjLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFDLElBQUk7UUFDbkMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNuQixDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsVUFBQyxDQUFRO1FBQ2QsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNoQixHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUN4QixDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDO0FBSUgsdUJBQXVCO0FBQ3ZCLG1FQUFtRTtBQUVuRSxvRUFBb0U7QUFDcEUseUJBQXlCO0FBQ3pCLDBEQUEwRDtBQUMxRCxzQ0FBc0M7QUFDdEMsZ0JBQWdCO0FBQ2hCLFNBQVM7QUFFVCxvRUFBb0U7QUFDcEUsOENBQThDO0FBQzlDLGlEQUFpRDtBQUNqRCx1QkFBdUI7QUFDdkIseUJBQXlCO0FBQ3pCLGdCQUFnQjtBQUNoQixjQUFjO0FBQ2Qsb0NBQW9DO0FBQ3BDLHNDQUFzQztBQUN0QyxZQUFZO0FBQ1osaUNBQWlDO0FBQ2pDLFNBQVM7QUFFVCw0REFBNEQ7QUFDNUQseUJBQXlCO0FBQ3pCLDRDQUE0QztBQUM1QyxrREFBa0Q7QUFDbEQsd0NBQXdDO0FBQ3hDLDBDQUEwQztBQUMxQyx1QkFBdUI7QUFDdkIsbUdBQW1HO0FBQ25HLDRDQUE0QztBQUM1Qyw0QkFBNEI7QUFDNUIsZ0JBQWdCO0FBQ2hCLFNBQVM7QUFFVCw2REFBNkQ7QUFDN0Qsa0JBQWtCO0FBQ2xCLHdCQUF3QjtBQUN4QixTQUFTO0FBRVQsaUVBQWlFO0FBQ2pFLHlCQUF5QjtBQUN6QixxQ0FBcUM7QUFDckMsd0NBQXdDO0FBQ3hDLDhDQUE4QztBQUM5Qyx5Q0FBeUM7QUFDekMsMENBQTBDO0FBQzFDLHVCQUF1QjtBQUN2QiwrREFBK0Q7QUFDL0QsK0JBQStCO0FBQy9CLHdDQUF3QztBQUN4Qyw2Q0FBNkM7QUFDN0Msd0JBQXdCO0FBQ3hCLHNCQUFzQjtBQUN0QiwrQkFBK0I7QUFDL0IsOENBQThDO0FBQzlDLDJCQUEyQjtBQUMzQix1REFBdUQ7QUFDdkQsOERBQThEO0FBQzlELHdEQUF3RDtBQUN4RCxtRUFBbUU7QUFDbkUsc0RBQXNEO0FBQ3RELCtCQUErQjtBQUMvQixrREFBa0Q7QUFDbEQsd0JBQXdCO0FBQ3hCLG9CQUFvQjtBQUNwQixnQkFBZ0I7QUFDaEIsZ0JBQWdCO0FBQ2hCLFNBQVM7QUFFVCxlQUFlO0FBQ2YsOEJBQThCO0FBQzlCLDhCQUE4QjtBQUM5QixzQkFBc0I7QUFDdEIsc0JBQXNCO0FBQ3RCLDBCQUEwQjtBQUMxQixTQUFTO0FBQ1QsSUFBSTtBQUVKLHFDQUFxQztBQUNyQyxxREFBcUQ7QUFDckQsbUNBQW1DO0FBQ25DLGtFQUFrRTtBQUNsRSx5QkFBeUI7QUFDekIsSUFBSSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJvdXRlciwgUmVxdWVzdCwgUmVzcG9uc2UgfSBmcm9tIFwiZXhwcmVzc1wiO1xuaW1wb3J0IHsgZ2V0UmVwb3NpdG9yeSB9IGZyb20gJy4uL3JlcG9zaXRvcmllcy91c2VyX3JlcG9zaXRvcnknO1xuaW1wb3J0IHsgVXNlciB9IGZyb20gXCIuLi9lbnRpdGllcy91c2VyXCI7XG5pbXBvcnQgeyBSZXBvc2l0b3J5IH0gZnJvbSBcInR5cGVvcm1cIjtcbmltcG9ydCAqIGFzIGp3dCBmcm9tIFwianNvbndlYnRva2VuXCI7XG5cbmNvbnN0IHVzZXJSb3V0ZXIgPSBSb3V0ZXIoKTtcbi8vIFJldHJ1bnMgYWxsIHVzZXJzXG51c2VyUm91dGVyLmdldChcIi9hcGkvdjEvdXNlcnNcIiwgZnVuY3Rpb24gKHJlcSwgcmVzKSB7XG4gICAgY29uc3QgdXNlclJlcG9zaXRvcnkgPSBnZXRSZXBvc2l0b3J5KCk7XG4gICAgdXNlclJlcG9zaXRvcnkuZmluZCgpLnRoZW4oKHVzZXIpID0+IHtcbiAgICAgICAgcmVzLmpzb24odXNlcik7XG4gICAgfSkuY2F0Y2goKGU6IEVycm9yKSA9PiB7XG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKTtcbiAgICAgICAgcmVzLnNlbmQoZS5tZXNzYWdlKTtcbiAgICB9KTtcbn0pO1xuXG4vLyBDcmVhdGVzIGEgbmV3IHVzZXIgYWNjb3VudFxudXNlclJvdXRlci5wb3N0KFwiL2FwaS92MS91c2Vyc1wiLCBmdW5jdGlvbiAocmVxLCByZXMpIHtcbiAgICBjb25zdCB1c2VyUmVwb3NpdG9yeSA9IGdldFJlcG9zaXRvcnkoKTtcbiAgICBjb25zdCBuZXdVc2VyID0gcmVxLmJvZHk7XG4gICAgaWYoISh0eXBlb2YgbmV3VXNlci5lbWFpbCA9PT0gXCJzdHJpbmdcIiB8fCB0eXBlb2YgbmV3VXNlci5wYXNzd29yZCA9PT0gXCJzdHJpbmdcIikpe1xuICAgICAgICByZXMuc3RhdHVzKDQwMCk7XG4gICAgICAgIHJlcy5zZW5kKGBJbnZhbGlkIFVzZXJuYW1lIG9yIFBhc3N3b3JkIWApO1xuICAgIH0gXG5cbiAgICAvLyBDaGVjayBpZiB0aGUgZW1haWwgaXMgYWxyZWFkeSB0YWtlblxuICAgIGNvbnN0IHVzZXJDaGVjayA9IHVzZXJSZXBvc2l0b3J5LmZpbmRPbmUoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgZW1haWw6IG5ld1VzZXIuZW1haWwsXG4gICAgICAgICAgICBwYXNzd29yZDogbmV3VXNlci5wYXNzd29yZFxuICAgICAgICB9XG4gICAgfSk7XG4gICAgLy8gUmV0dXJuIGVycm9yIDQwMCBpbiBjYXNlIGVtYWlsIGhhcyBhbHJlYWR5IGJlZW4gdGFrZW5cbiAgICBpZiAodXNlckNoZWNrKSB7XG4gICAgICAgIHJlcy5zdGF0dXMoNDAwKTtcbiAgICAgICAgcmVzLnNlbmQoYEVtYWlsIGFscmVhZHkgdGFrZW4sIHBsZWFzZSB0cnkgYW5vdGhlciBvbmUuYCk7XG4gICAgfVxuICAgIC8vIFJldHVybiB0aGUgbmV3IHVzZXIgb2JqZWN0LlxuICAgIHVzZXJSZXBvc2l0b3J5LmZpbmQobmV3VXNlcikudGhlbigodXNlcikgPT4ge1xuICAgICAgICByZXMuanNvbih1c2VyKTtcbiAgICB9KS5jYXRjaCgoZTogRXJyb3IpID0+IHtcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApO1xuICAgICAgICByZXMuc2VuZChlLm1lc3NhZ2UpO1xuICAgIH0pO1xufSk7XG5cbmV4cG9ydCB7IHVzZXJSb3V0ZXIgfTtcblxuLy8gSGFuZGxlIEhUVFAgcmVxdWVzdHNcbi8vIGV4cG9ydCBmdW5jdGlvbiBnZXRIYW5kbGVycyhfdXNlclJlcG9zaXRvcnk6IFJlcG9zaXRvcnk8VXNlcj4pIHtcbiAgICBcbi8vICAgICBjb25zdCBnZXRBbGxVc2Vyc0hhbmRsZXIgPSAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XG4vLyAgICAgICAgIChhc3luYyAoKSA9PiB7XG4vLyAgICAgICAgICAgICBjb25zdCB1c2VycyA9IGF3YWl0IF91c2VyUmVwb3NpdG9yeS5maW5kKCk7XG4vLyAgICAgICAgICAgICByZXMuanNvbih1c2Vycykuc2VuZCgpO1xuLy8gICAgICAgICB9KSgpO1xuLy8gICAgIH07XG4gICAgXG4vLyAgICAgY29uc3QgZ2V0VXNlckJ5SWRIYW5kbGVyID0gKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xuLy8gICAgICAgICBjb25zdCBpZCA9IHBhcnNlSW50KHJlcS5wYXJhbXMuaWQpO1xuLy8gICAgICAgICBjb25zdCB1c2VyID0gX3VzZXJSZXBvc2l0b3J5LmZpbmRPbmUoe1xuLy8gICAgICAgICAgICAgd2hlcmU6IHtcbi8vICAgICAgICAgICAgICAgICBpZDogaWRcbi8vICAgICAgICAgICAgIH1cbi8vICAgICAgICAgfSk7XG4vLyAgICAgICAgIGlmICh1c2VyID09PSB1bmRlZmluZWQpIHtcbi8vICAgICAgICAgICAgIHJlcy5zdGF0dXMoNDA0KS5zZW5kKCk7XG4vLyAgICAgICAgIH1cbi8vICAgICAgICAgcmVzLmpzb24odXNlcikuc2VuZCgpO1xuLy8gICAgIH07XG5cbi8vICAgICBjb25zdCBjcmVhdGVVc2VyID0gKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xuLy8gICAgICAgICAoYXN5bmMgKCkgPT4ge1xuLy8gICAgICAgICAgICAgY29uc3QgZW1haWwgPSByZXEuYm9keS5lbWFpbDtcbi8vICAgICAgICAgICAgIGNvbnN0IHBhc3N3b3JkID0gcmVxLmJvZHkucGFzc3dvcmQ7XG4vLyAgICAgICAgICAgICBpZiAoIWVtYWlsIHx8IHBhc3N3b3JkKSB7XG4vLyAgICAgICAgICAgICAgICAgcmVzLnN0YXR1cyg0MDApLnNlbmQoKTtcbi8vICAgICAgICAgICAgIH0gZWxzZSB7XG4vLyAgICAgICAgICAgICAgICAgY29uc3QgbmV3dXNlciA9IGF3YWl0IF91c2VyUmVwb3NpdG9yeS5zYXZlKHsgZW1haWw6IGVtYWlsLCBwYXNzd29yZDogcGFzc3dvcmR9KTtcbi8vICAgICAgICAgICAgICAgICByZXR1cm4gcmVzLmpzb24obmV3dXNlcik7XG4vLyAgICAgICAgICAgICB9ICAgICAgICAgICAgXG4vLyAgICAgICAgIH0pKCk7XG4vLyAgICAgfTtcblxuLy8gICAgIGNvbnN0IGRlbGV0ZVVzZXIgPSAgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xuLy8gICAgICAgICAvLyBUT0RPXG4vLyAgICAgICAgIHJlcy5qc29uKHt9KTtcbi8vICAgICB9O1xuXG4vLyAgICAgY29uc3QgZ2V0VG9rZW5IYW5kbGVyID0gKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xuLy8gICAgICAgICAoYXN5bmMgKCkgPT4ge1xuLy8gICAgICAgICAgICAgY29uc3QgYm9keSA9IHJlcS5ib2R5O1xuLy8gICAgICAgICAgICAgY29uc3QgZW1haWwgPSBib2R5LmVtYWlsO1xuLy8gICAgICAgICAgICAgY29uc3QgcGFzc3dvcmQgPSBib2R5LnBhc3N3b3JkO1xuLy8gICAgICAgICAgICAgaWYgKCFlbWFpbCB8fCAhcGFzc3dvcmQpIHtcbi8vICAgICAgICAgICAgICAgICByZXMuc3RhdHVzKDQwMCkuc2VuZCgpO1xuLy8gICAgICAgICAgICAgfSBlbHNlIHtcbi8vICAgICAgICAgICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgX3VzZXJSZXBvc2l0b3J5LmZpbmRPbmUoe1xuLy8gICAgICAgICAgICAgICAgICAgICB3aGVyZToge1xuLy8gICAgICAgICAgICAgICAgICAgICAgICAgZW1haWw6IGVtYWlsLFxuLy8gICAgICAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkXG4vLyAgICAgICAgICAgICAgICAgICAgIH1cbi8vICAgICAgICAgICAgICAgICB9KTtcbi8vICAgICAgICAgICAgICAgICBpZiAoIXVzZXIpIHtcbi8vICAgICAgICAgICAgICAgICAgICAgcmVzLnN0YXR1cyg0MDEpLnNlbmQoKTtcbi8vICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuLy8gICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXlsb2FkID0geyBpZDogdXNlci5pZCB9O1xuLy8gICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWNyZXQgPSBwcm9jZXNzLmVudi5BVVRIX1NFQ1JFVDtcbi8vICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBzZWNyZXQgPT09IFwic3RyaW5nXCIpIHtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRva2VuID0gand0LnNpZ24ocGF5bG9hZCwgc2VjcmV0KTtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5qc29uKHsgdG9rZW46IHRva2VuIH0pO1xuLy8gICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuLy8gICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnN0YXR1cyg1MDApLnNlbmQoKTtcbi8vICAgICAgICAgICAgICAgICAgICAgfVxuLy8gICAgICAgICAgICAgICAgIH1cbi8vICAgICAgICAgICAgIH1cbi8vICAgICAgICAgfSkoKTtcbi8vICAgICB9O1xuXG4vLyAgICAgcmV0dXJuIHtcbi8vICAgICAgICAgZ2V0QWxsVXNlcnNIYW5kbGVyLFxuLy8gICAgICAgICBnZXRVc2VyQnlJZEhhbmRsZXIsXG4vLyAgICAgICAgIGNyZWF0ZVVzZXIsXG4vLyAgICAgICAgIGRlbGV0ZVVzZXIsXG4vLyAgICAgICAgIGdldFRva2VuSGFuZGxlclxuLy8gICAgIH07XG4vLyB9XG5cbi8vIGV4cG9ydCBmdW5jdGlvbiBnZXRMaW5rc1JvdXRlcigpIHtcbi8vICAgICBjb25zdCBoYW5kbGVycyA9IGdldEhhbmRsZXJzKGdldFJlcG9zaXRvcnkoKSk7XG4vLyAgICAgY29uc3QgdXNlclJvdXRlciA9IFJvdXRlcigpO1xuLy8gICAgIHVzZXJSb3V0ZXIucG9zdChcIi9hcGkvdjEvdXNlcnNcIiwgaGFuZGxlcnMuZ2V0VG9rZW5IYW5kbGVyKTtcbi8vICAgICByZXR1cm4gdXNlclJvdXRlcjtcbi8vIH0iXX0=